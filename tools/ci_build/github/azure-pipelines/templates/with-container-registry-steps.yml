# runs the specified steps while logged in to the container registry

parameters:
- name: Steps
  type: stepList
- name: ContainerRegistry
  type: string

steps:
- script: |
    set -x
    az login --identity --username 63b63039-6328-442f-954b-5a64d124e5b4
    az acr login onnxruntimebuildcache
    az acr login onnxruntimeregistry    

- ${{ parameters.Steps }}

- task: Docker@2
  inputs:
    containerRegistry: onnxruntimebuildcache
    command: "logout"
    addPipelineData: false
  displayName: "Log out of container registry"
  condition: always()

- task: Docker@2
  inputs:
    containerRegistry: onnxruntimeregistry
    command: "logout"
    addPipelineData: false
  displayName: "Log out of container registry"
  condition: always()