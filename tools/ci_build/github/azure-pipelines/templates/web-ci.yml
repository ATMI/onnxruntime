parameters:
- name: NpmPackagingMode
  displayName: 'NPM packages publish configuration'
  type: string
  default: 'dev'
- name: IsReleasePipeline
  displayName: 'Npm packaging pipeline'
  type: boolean
  default: false
- name: PoolName
  displayName: 'Agent pool name'
  type: string
  default: 'onnxruntime-Win-CPU-2022'
- name: PackageName
  displayName: 'Package name'
  type: string
  default: 'NPM_packages'
- name: BuildStaticLib
  displayName: 'Build static library'
  type: boolean
  default: false
- name: BuildJsep
  displayName: 'Build JSEP'
  type: boolean
  default: true

- name: WASMTemplate
  type: string
  default: linux-wasm-ci.yml
# parameter couldn't be compared by string, so add one boolean parameter.
- name: UseWebPoolName
  type: boolean
  default: false
- name: RunWebGpuTestsForReleaseBuild
  type: boolean
  default: false
- name: RunWebGpuTestsForDebugBuild
  type: boolean
  default: false
- name: WebGpuPoolName
  type: string
  default: 'onnxruntime-Win2022-webgpu-A10'
- name: WebCpuPoolName
  type: string
  default: 'onnxruntime-Win-CPU-2022-web'

- name: ExtraBuildArgs
  displayName: 'Extra build command line arguments'
  type: string

- name: WithCache
  displayName: Build with Cache
  type: boolean
  default: false

stages:
- stage: Build_web_Release
  jobs:
  - template: win-web-ci.yml
    parameters:
      CommitOverride: true
      BuildConfig: 'Release'
      NpmPackagingMode: ${{ parameters.NpmPackagingMode }}
      ${{ if eq(parameters.UseWebPoolName, true)}}:
        ${{ if eq(parameters.RunWebGpuTestsForReleaseBuild, true)}}:
          PoolName: ${{ parameters.WebGpuPoolName }}
        ${{ else }}:
          PoolName: ${{ parameters.WebCpuPoolName }}
      ${{ else }}:
        PoolName: ${{ parameters.PoolName }}
      PackageName: ${{ parameters.PackageName }}
      RunWebGpuTests: ${{ parameters.RunWebGpuTestsForReleaseBuild }}
